\makeatletter
\newcommand{\manvarseparator}[1]{\gdef\manvarseparator@{#1}}
\def\manvarseparator@{~}
\def\varseparator@{\space}
\newcommand{\varseparator}[1]{\gdef\varseparator@{#1}}
\let\varnote@\Afootnote
\newcommand{\varseries}[1]{\letcs{\varnote@}{#1footnote}}
\def\manuscripts@{}

\newcommand{\manuscript}[1]{%
	\renewcommand{\do}[1]{\listgadd{\manuscripts@}{##1}}%
	\docsvlist{#1}%
}


\newcommandx*{\var}[5][1,5,usedefault]{%
    \edtext{#2}{%
    	\ifstrempty{#1}{}{\lemma{#1}}%
    	\varnote@{%
        	\ifstrempty{#3}{}%
		{\del@{#3}%
		\ifstrempty{#4}%
			{}%
			{\varseparator@}%
		}%
        	\var@{#4}%
    	}%
	#5%
    }%
}

\newcommand{\var@}[1]{%
	\newif\iffirst%
	\firsttrue%
	\renewcommand{\do}[1]{\iffirst\firstfalse\else\varseparator@\fi{\var@@##1}}%
	\docsvlist{#1}%
	}

\newcommand{\del@}[1]{%
	\renewcommand{\do}[1]{%
		\print@manuscript{##1}%
	}%
	\docsvlist{#1}\manvarseparator@\emph{omit}%
}
\newcommand{\print@manuscript}[1]{%
	\ifinlist{#1}{\manuscripts@}%
		{#1}%
		{\eledmac@warning{Unknew man. #1, p.\the\page@num  ; l.\the\line@num}\underline{unknew man. #1}}%
	}

\newcommand{\var@@}[2]{%
	\renewcommand{\do}[1]{%
		\print@manuscript{##1}%
		}%
	\docsvlist{#1}\manvarseparator@#2%
	}
\makeatother